MQTT interface
==============

Homebattery can be controlled and monitored over MQTT. Only MQTT v5 is supported.

For configuration of MQTT, see the :doc:`configuration page <configuration>`.

General
-------

``<root>`` is the MQTT topic root set in the configuration.

+------------------------------------+------------+-----------+--------+--------------------------------------------------------------------------+
| Topic                              | Datatype   | Direction | Unit   | Description                                                              |
+====================================+============+===========+========+==========================================================================+
| ``<root>/mode/set``                | ``utf-8``  | W         | n.a.   | Requested operation mode.                                                |
|                                    |            |           |        |                                                                          |
|                                    |            |           |        | Possible values are ``charge``, ``discharge``, ``idle`` and ``protect``. |
+------------------------------------+------------+-----------+--------+--------------------------------------------------------------------------+
| ``<root>/mode/actual``             | ``utf-8``  | R         | n.a.   | Current operation mode.                                                  |
|                                    |            |           |        |                                                                          |
|                                    |            |           |        | Possible values are ``charge``, ``discharge``, ``idle`` and ``protect``. |
+------------------------------------+------------+-----------+--------+--------------------------------------------------------------------------+
| ``<root>/locked``                  | ``utf-8``  | R         | n.a.   | Reason for system lock.                                                  |
|                                    |            |           |        |                                                                          |
|                                    |            |           |        | Only the reason with the highest priority is sent.                       |
|                                    |            |           |        |                                                                          |
|                                    |            |           |        | An empty payload means that there is no lock.                            |
+------------------------------------+------------+-----------+--------+--------------------------------------------------------------------------+
| ``<root>/reset``                   | ``utf-8``  | W         | n.a.   | Writing the value ``reset`` to this topic will lead to a system reset.   |
+------------------------------------+------------+-----------+--------+--------------------------------------------------------------------------+

Charger related
---------------

``<root>`` is the MQTT topic root set in the configuration.

``<name>`` is the device name set in the configuration.

+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| Topic                              | Datatype   | Direction | Unit   | Description                                                                   |
+====================================+============+===========+========+===============================================================================+
| ``<root>/cha/state``               | ``int8``   | R         | n.a.   | Charger state. ``0`` means charger is off, ``1`` means charger is on,         |
|                                    |            |           |        |                                                                               |
|                                    |            |           |        | ``-1`` means charger is in fault or syncing state.                            |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/cha/e``                   | ``uint16`` | R         | Wh     | Overall charger energy. Value is reset after every transmission.              |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/cha/dev/<name>/e``        | ``uint16`` | R         | Wh     | Charger energy of a single device. Value is reset after every transmission.   |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+

Inverter related
----------------

``<root>`` is the MQTT topic root set in the configuration.

``<name>`` is the device name set in the configuration.

+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| Topic                              | Datatype   | Direction | Unit   | Description                                                                   |
+====================================+============+===========+========+===============================================================================+
| ``<root>/inv/state``               | ``int8``   | R         | n.a.   | Inverter state. ``0`` means inverter is off, ``1`` means inverter is on,      |
|                                    |            |           |        |                                                                               |
|                                    |            |           |        | ``-1`` means charger is in fault or syncing state.                            |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/inv/p``                   | ``uint16`` | R         | W      | Overall inverter power.                                                       |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/inv/e``                   | ``uint16`` | R         | Wh     | Overall inverter energy. Value is reset after every transmission.             |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/inv/dev/<name>/p``        | ``uint16`` | R         | W      | Inverter power of a single device.                                            |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/inv/dev/<name>/e``        | ``uint16`` | R         | Wh     | Inverter energy of a single device. Value is reset after every transmission.  |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+

Solar related
-------------

``<root>`` is the MQTT topic root set in the configuration.

``<name>`` is the device name set in the configuration.

+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| Topic                              | Datatype   | Direction | Unit   | Description                                                                   |
+====================================+============+===========+========+===============================================================================+
| ``<root>/sol/state``               | ``int8``   | R         | n.a.   | Solar state. ``0`` means solar is off, ``1`` means solar is on,               |
|                                    |            |           |        |                                                                               |
|                                    |            |           |        | ``-1`` means solar is in fault or syncing state.                              |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/sol/p``                   | ``uint16`` | R         | W      | Overall solar power.                                                          |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/sol/e``                   | ``uint16`` | R         | Wh     | Overall solar energy. Value is reset after every transmission.                |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/sol/dev/<name>/p``        | ``uint16`` | R         | W      | Solar power of a single device.                                               |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+
| ``<root>/sol/dev/<name>/e``        | ``uint16`` | R         | Wh     | Solar energy of a single device. Value is reset after every transmission.     |
+------------------------------------+------------+-----------+--------+-------------------------------------------------------------------------------+

Battery related
---------------

``<root>`` is the MQTT topic root set in the configuration.

``<name>`` is the battery name set in the configuration.

+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
| Topic                              | Datatype   | Direction | Unit        | Description                                                              |
+====================================+============+===========+=============+==========================================================================+
| ``<root>/bat/i``                   | ``int16``  | R         | A / 10      | Overall battery current. Positive values indicate charging.              |
+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
| ``<root>/bat/c``                   | ``uint16`` | R         | Ah / 10     | Overall remaining capacity.                                              |
+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
| ``<root>/bat/dev/<name>/v``        | ``uint16`` | R         | V / 100     | Voltage of a single battery.                                             |
+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
| ``<root>/bat/dev/<name>/i``        | ``int16``  | R         | A / 10      | Current of a single battery. Positive values indicate charging.          |
+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
| ``<root>/bat/dev/<name>/soc``      | ``uint8``  | R         | %           | State of charge of a single battery.                                     |
+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
| ``<root>/bat/dev/<name>/c``        | ``uint16`` | R         | Ah / 10     | Remaining capacity of a single battery.                                  |
+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
| ``<root>/bat/dev/<name>/n``        | ``uint16`` | R         | n.a.        | Cycles of a single battery.                                              |
+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
| ``<root>/bat/dev/<name>/temp/<n>`` | ``uint16`` | R         | °C / 10     | Cell temperature of a single battery. ``<n>`` is the sensor number.      |
+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
| ``<root>/bat/dev/<name>/cell/<n>`` | ``int16``  | R         | mV          | Cell voltage of a single battery. ``<n>`` is the cell number.            |
+------------------------------------+------------+-----------+-------------+--------------------------------------------------------------------------+
